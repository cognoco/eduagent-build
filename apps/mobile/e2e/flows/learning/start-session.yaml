# Flow: Start a Learning Session & Send a Message
# Validates: session screen renders, chat input works, AI responds.
# Tags: smoke, learning
#
# Prerequisites:
#   - User is signed in
#   - At least one subject exists (e.g., from the create-subject flow)
#   - API is running with a valid LLM configuration
#
# NOTE: This flow navigates from the coaching card's primary action,
# which typically links to a session for the user's active subject.
# If no coaching card is present, the flow will not proceed past
# the home screen. In CI, seed data should ensure a coaching card.
appId: com.zwizzly.eduagent
tags:
  - smoke
  - learning
---
- launchApp

# Assert home screen is visible
- extendedWaitUntil:
    visible:
      text: "Ready to learn"
    timeout: 15000

# The coaching card's primary button starts a session.
# Its testID is "coaching-card-primary".
- tapOn:
    id: "coaching-card-primary"
    optional: true

# The session screen shows one of: "Learning Session", "Homework Help",
# "Practice Session", or "Chat" in the ChatShell header.
# We check for the chat input which is always present.
- extendedWaitUntil:
    visible:
      id: "chat-input"
    timeout: 10000

# Type a message in the chat input
- tapOn:
    id: "chat-input"
- inputText: "Hello, can you help me understand the basics?"

# Tap send button (testID: send-button)
- tapOn:
    id: "send-button"

# Wait for the AI response to appear.
# The send button should become re-enabled once streaming is done.
# We verify the chat input is still present (session didn't crash).
- extendedWaitUntil:
    visible:
      id: "chat-input"
    timeout: 15000

- takeScreenshot: learning-session-message-sent
