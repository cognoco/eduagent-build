# Flow S3: Core Learning — Session to Summary
# Validates: full learning loop with 3 exchanges, session close, and summary.
# Tags: smoke, learning
#
# Journey: UX Journey 2 (Daily Learning Loop)
# Epics: Epic 2 (FR23-FR26, FR41)
# Prerequisite: Seeded user with subject + coaching card (scenario: learning-active)
appId: com.zwizzly.eduagent
tags:
  - smoke
  - learning
---
# 1. Seed & sign in
- runFlow:
    file: ../_setup/seed-and-sign-in.yaml
    env:
      SEED_SCENARIO: "learning-active"
      API_URL: ${API_URL}

# 2. Home screen
- extendedWaitUntil:
    visible:
      text: "Ready to learn"
    timeout: 15000

# 3. Start session via coaching card
- tapOn:
    id: "coaching-card-primary"

# 4. Session active — chat input present
- extendedWaitUntil:
    visible:
      id: "chat-input"
    timeout: 10000

# 5. Exchange 1: user question
- tapOn:
    id: "chat-input"
- inputText: "Explain the concept to me"
- tapOn:
    id: "send-button"

# 6. Wait for AI response
- extendedWaitUntil:
    visible:
      id: "chat-input"
    timeout: 15000

# 7. Exchange 2: follow-up
- tapOn:
    id: "chat-input"
- inputText: "Can you give me an example?"
- tapOn:
    id: "send-button"

# 8. Wait for response
- extendedWaitUntil:
    visible:
      id: "chat-input"
    timeout: 15000

# 9. Exchange 3: clarification
- tapOn:
    id: "chat-input"
- inputText: "I think I understand, let me try to explain it back"
- tapOn:
    id: "send-button"

# 10. Wait for response
- extendedWaitUntil:
    visible:
      id: "chat-input"
    timeout: 15000

# 11. Session close — either auto-closes after exchange cap or manual
# Look for summary screen or close button
# NOTE: Session auto-close depends on exchange count config. If still active,
# the flow verifies the session survived 3 exchanges without crashing.
- extendedWaitUntil:
    visible:
      id: "summary-score"
    timeout: 20000
    optional: true

# 12. If summary screen appeared, verify content
- assertVisible:
    id: "summary-topics"
    optional: true

# 13. Close summary and return to home
- tapOn:
    id: "summary-close"
    optional: true

# 14. Verify we can reach home
- extendedWaitUntil:
    visible:
      text: "Ready to learn"
    timeout: 10000
    optional: true

# 15. Screenshot
- takeScreenshot: core-learning-complete
