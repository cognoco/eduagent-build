# Flow S4: Retention — Recall Prompt to Score
# Validates: seeded user with due retention cards sees recall prompt,
# enters answer, receives score feedback.
# Tags: smoke, retention
#
# Journey: UX Journey 2 (recall phase)
# Epics: Epic 3 (FR43, FR48, FR49)
# Prerequisite: Seeded user with completed sessions + due retention cards
#               (scenario: retention-due)
#
# testID mapping (recall-test.tsx uses ChatShell):
#   - recall-test-screen    → screen wrapper
#   - recall-messages       → message scroll area
#   - chat-input            → text input (from ChatShell)
#   - send-button           → send button (from ChatShell)
#   - remediation-card      → shown after 3+ failures
appId: com.zwizzly.eduagent
tags:
  - smoke
  - retention
---
# 1. Seed & sign in with retention-due scenario
- runFlow:
    file: ../_setup/seed-and-sign-in.yaml
    env:
      SEED_SCENARIO: "retention-due"
      API_URL: ${API_URL}

# 2. Home screen
- extendedWaitUntil:
    visible:
      text: "Ready to learn"
    timeout: 15000

# 3. Coaching card should indicate recall/review is due.
- assertVisible:
    id: "coaching-card"

# 4. Tap the coaching card's primary action (triggers recall)
- tapOn:
    id: "coaching-card-primary"

# 5. Recall screen loads — verify the recall-test wrapper
- extendedWaitUntil:
    visible:
      id: "recall-test-screen"
    timeout: 10000

# 5b. Verify the opening recall prompt is visible
- assertVisible:
    text: "what you remember"

# 6. Enter recall answer via ChatShell's chat-input
- tapOn:
    id: "chat-input"
- inputText: "I remember the key concept is about how this works in practice"

# 7. Submit answer via ChatShell's send-button
- tapOn:
    id: "send-button"

# 8. Wait for AI feedback response
- extendedWaitUntil:
    visible:
      id: "chat-input"
    timeout: 15000

# 9. Screenshot
- takeScreenshot: retention-recall-complete
