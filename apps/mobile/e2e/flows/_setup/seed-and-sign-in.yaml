# Reusable setup: Seed test data via API, then sign in via the app UI.
#
# Called by other flows via:
#   - runFlow:
#       file: _setup/seed-and-sign-in.yaml
#       env:
#         SEED_SCENARIO: with-subject
#         API_URL: ${API_URL}
#
# Environment variables:
#   SEED_SCENARIO  — Seed scenario key (e.g., "with-subject", "retention-due")
#   API_URL        — Base URL for the API (default: http://10.0.2.2:8787 for Android emulator)
#
# After this flow completes, the app is authenticated and on the home screen.
#
# The seed endpoint creates a real Clerk user (when CLERK_SECRET_KEY is set)
# and returns the password in the response. Maestro uses these credentials
# to sign in via the Clerk-powered login UI.
appId: com.zwizzly.eduagent
---
# Step 1: Seed test data via API
- runScript:
    file: ../../scripts/seed.js
    env:
      API_URL: ${API_URL}
      SCENARIO: ${SEED_SCENARIO}
    outputVariable: seedResult

# Step 2: Launch app with clean state
- launchApp:
    clearState: true

# Step 3: Wait for auth screen
- extendedWaitUntil:
    visible:
      text: "Welcome back"
    timeout: 15000

# Step 4: Sign in with seeded credentials
- tapOn:
    id: "sign-in-email"
- inputText: ${output.seedResult.email}
- tapOn:
    id: "sign-in-password"
- inputText: ${output.seedResult.password}
- tapOn:
    id: "sign-in-button"

# Step 5: Wait for home screen (auth complete)
- extendedWaitUntil:
    visible:
      text: "Ready to learn"
    timeout: 15000
